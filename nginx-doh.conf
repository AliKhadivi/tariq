# server{

#         listen 8080;
#         listen [::]:8080;
#         server_name doh.fcms.ir;

#         location / {
# #                proxy_pass http://127.0.0.1:8053/;
#                 return https://doh.fcms.ir:${DOH_PORT}$request_uri;
#         }
# }

server{

        listen ${DOH_PORT} ssl;
        listen [::]:${DOH_PORT} ssl;
        server_name ${domain};

        location / {
                proxy_pass http://127.0.0.1:8053/;
                proxy_set_header Host      $host;
                proxy_set_header X-Real-IP $remote_addr;
        }

        ssl_certificate ${cert_path};
        ssl_certificate_key ${key_path};
        ssl_dhparam ${dhparam_path};
        ssl_protocols TLSv1.2 TLSv1.3;          # TLS 1.3 requires nginx >= 1.13.0
        ssl_prefer_server_ciphers on;
        ssl_ciphers EECDH+AESGCM:EDH+AESGCM;
        ssl_ecdh_curve secp384r1;               # Requires nginx >= 1.1.0
        ssl_session_timeout  10m;
        ssl_session_cache shared:SSL:10m;
        ssl_session_tickets off;                # Requires nginx >= 1.5.9
        ssl_stapling on;                        # Requires nginx >= 1.3.7
        ssl_stapling_verify on;                 # Requires nginx => 1.3.7
        ssl_early_data off;                     # 0-RTT, enable if desired - Requires nginx >= 1.15.4
        resolver 1.1.1.1 valid=300s;            # Replace with your local resolver
        resolver_timeout 5s;
        # HTTP Security Headers
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        add_header Strict-Transport-Security "max-age=63072000";
}

